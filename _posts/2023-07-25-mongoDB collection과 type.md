---
title: mongoDB collection과 type
author: heehong
date: 2023-07-24 19:00:00 +0800
categories: [mongoDB]
tags: [데이터베이스, noSql, mongoDB, 몽고디비 인 액션]
published: true
---

### 컬렉션
컬렉션은 구조적으로 혹은 개념적으로 비슷한 도큐먼트를 담고 있는 컨테이너다.
별도의 명령어 없이 도큐먼트를 네임스페이스에 삽입하는 것만으로도 컬렉션이 생성된다.

```javascript
db.createCollection ("users")ss
```
컬렉션을 생성하는 명령어 이다.

```javascript
db.createCollection ("users", {size: 20000})
```
컬렉션을 생성할때 크기를 미리 할당하는 옵션이 있다.

컬렉션의 이름은 숫자와 알파벳 또는 . 으로 만들 수 있으나 알파벳이나 숫자로 시작해야 한다.
내부적으로 컬레션 이름에는 자신이 속한 데이터베이스 이름이 포함되어 있다. databaseName.users
컬렉션의 전체 이름, 즉 네임스페이스는 128자 이내여야 한다.

```javascript
db.products. renameCollection ("users_change")
```
컬렉션의 이름을 변경할 수 있다.


### 캡드 컬렉션
캡드 컬레션은 높은 성능의 로깅 기능을 위해 설계되었다. 일반 컬렉션과 다른 점은 고정된 크기를 갖는다는 점이다.
캡드 컬렉션이 더 이상의 공간이 없게 되면 도큐먼트를 삽일할 떄 컬렉션에 추가된 지 가장 오래된 도큐먼트를 덮어쓰게된다.
수동으로 컬렉션의 오래된 데이터를 지워야만 하는 번거로움을 없애준다.

캡드 컬렉션은 일반적인 보통 컬렉션에 모든 연산이 가능하도록 허용하지 않는다. 
캡드 컬렉션에서 개별 도큐먼트를 삭제할 수 없고, 마찬가지로 도큐먼트의 크기를 증가시키는 어떤 업데이트도 수행할 수 없다.


### TTL컬렉션
컬렉션에서 특정시간이 경과한 도큐먼트를 만료시킬 수 있는 기능을 제공한다.
이는 특별한 인덱스를 사용하여 구현한 것이다.

```javascript
db.reviews.createIndex({time_field: 1}, {expireAfterSeconds: 3600})
```
주기적으로 타임스탬프 값을 체크하여 현재 시간과 비교를 수행한다.
만약 time_field 값과 현재 시간 사이에 차이가 expireAfterSeconds 설정 값보다 크게 되면 해당 도큐먼트는 자동적으로 삭제될 것이다.

_id 필드 또는 이미 다른 인덱스에서 사용되고 있는 필드에 대해서는 TTL 인덱스를 가질 수가 없다.
캡드 컬렉션에 대해서도 TTL 인덱스를 가질 수 없다. 캡드 컬렉션이 개별 도큐먼트를 삭제하는 것을 지원하지 않기 때문이다.

### 시스템 컬렉션

```javascript
db.system.namespaces.find()
```
현재 사용 중인 데이터베이스에서 정의된 모든 네임스페이스를 보여준다.


```javascript
db.system.indexes.find()
```
현재 사용 중인 데이터베이스에서 정의된 모든 인덱스 리스트를 보여준다.

> 모든 도큐먼트는 mongoDB에 저장하기 전에 BSON 으로 serialize 되고, 나중에 BSON으로부터 deserialize 된다. 
> 드라이버는 이러한 과정을 처리하고, 그 프로그래밍 언어를 통해 적절한 데이터 타입으로 변환하게 된다.

### 문자열
모든 문자열 UTF-8 형식이어야 한다.
레거시 시스템에서 사용하던 데이터를 mongoDB로 import 할 때, mongoDB로 변환하기 전에 미리 UTF-8로 변환을 하든지, 텍스트를
BSON 바이너리 타입으로 저장하면 된다.

### 숫자
BSON은 double, int, long 의 세가지 수 타입을 규정한다.
BSON이 IEEE 실수와 signed정수를 8바이트까지 인코딩할 수 있다는 것을 뜻한다.
BSON수 타입에서 발생하는 문제점은 decimal을 지원하지 않는다는 점이다.
currency 값을 저장하려고 한다면 정수 타입을 사용해야 한다.

### 날짜와 시간
BSON datetime 타입은 시간이나 날짜에 관련된 값을 저장하는데 사용된다.
시간은 signed 64비트 정수를 사용해서 유닉스 에폭 이후 밀리초로 표현한다.
음수는 에폭 이전의 밀리초를 나타낸다.

### 가상타입
BSON의 데이터 타입만으로는 충분하지 않는 경우가 있다. BSON 타입을 임의로 만드는 것은 불가능하지만,
여러가지의 기본적인 BSON 타입을 사용해서 가상의 타입을 만들어 낼 수는 있다.


> 도큐먼트의 최대 크기는 16MB 이다.
1. 개발자가 효율적이지 못한 데이터 모델을 생성하는 것을 막기 위해서이다. 16MB의 제한은 과도하게 큰 도큐먼트를 가지는 스키마를 방지할 수 있게해준다. 16MB보다 큰 도큐먼트를 저장할 경우에는 스키마를 작은 도큐먼트로 나누어 저장할지, 정보를 저장하기에 알맞은 장소에 있는지 등의 여부를 고려해야 한다.
2. 코어 서버에서 크기가 큰 도큐먼트에 질의하면 질의 결과를 클라이언트로 보내기 전에 큰 도큐먼트가 버퍼에 복사되어야 한다. 도큐먼트의 일부만 필요한 경우에 성능에 문제가 된다. 질의가 보내진 다음에는 도큐먼트를 네트워크상에서 전송하고 드라이버에서 deserialize 한다. 수 메가바이트 크기의 도큐먼트가 한꺼번에 여러 개가 요청될 때 특별히 리소스를 많이 사용하게 된다.
3. 도큐먼트의 최대 중첩 깊이는 100으로 제한되어 있다. 중첩은 도큐먼트 안에 도큐먼트를 저장할 때마다 발생하게 된다.


### 대량 삽입 연산
모든 드라이버에서는 여러 개의 도큐먼트를 동시에 삽입할 수 있다. 초기화 할 때 대량의 데이터를 import한다든지, 다른 데이터베이스 시스템에서 mongoDB로 옮겨온 경우에서와 같이 많은 수의 데이터를 삽입할 때 매우 유용하다.

대량 삽입 연산은 주로 성능적인 측면에서 유용하다. 서버로 보내는 단 한번의 왕복 통신을 뜻한다. 하지만 대량 삽입 연산은 제한사항이 존재하는데, 만약 100만건의 도큐먼트를 삽입하려면 이를 여러 개의 대량 삽입 도큐먼트 그룹으로 나누어야 한다.

대량 삽입의 이상적인 크기는 너무 많은 요인에 따라 달라질 수 있으나, 10에서 200사이가 적당하다. 데이터베이스에 유일한 제한은 어떠한 삽입연산도 16MB이상은 허용되지 않는다. 